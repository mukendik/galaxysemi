<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.galaxysemi</groupId>
        <artifactId>galaxy_dev</artifactId>
        <version>7.7.33-SNAPSHOT</version>
        <relativePath>../../../../pom.xml</relativePath>
    </parent>

    <artifactId>quantix-patman</artifactId>
    <packaging>pom</packaging>
    <name>Quantix product - package - patman</name>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <basepath>galaxy_products/gex_product/buildpackage</basepath>
        <packageName>quantix-patman</packageName>
        <packageFolder>${project.artifactId}-package</packageFolder>
        <skipMac>true</skipMac>
        <skipRpm>true</skipRpm>
        <skipCentos6SysLibs>true</skipCentos6SysLibs>
    </properties>

    <dependencies>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <classifier>core-${distNameLong}-component</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <classifier>core-component${oemClassifier}</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <classifier>core-report-component</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <classifier>buildpackage-res</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>galaxy-resources</artifactId>
            <classifier>res</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>gex-src</artifactId>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>gsd</artifactId>
            <classifier>${distName}-bin-daemon</classifier>
            <type>${archiveExt}</type>
        </dependency>
      <dependency>
          <groupId>com.galaxysemi</groupId>
          <artifactId>gsd-pat</artifactId>
          <classifier>${distName}-bin-daemon-pat</classifier>
          <type>${archiveExt}</type>
      </dependency>        
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <classifier>email-${distName}-component</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <classifier>ftp-${distName}-component</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>gexdb_plugin_galaxy</artifactId>
            <classifier>${distName}-lib</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>gexdb_plugin_medtronic</artifactId>
            <classifier>${distName}-lib</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>pat</artifactId>
            <classifier>${distName}-bin-pat</classifier>
            <type>${archiveExt}</type>
        </dependency>
    </dependencies>

    <build>
        <sourceDirectory>${project.basedir}/src</sourceDirectory>
        <plugins>
            <plugin>
                <artifactId>maven-install-plugin</artifactId>
                <configuration>
                    <createChecksum>true</createChecksum>
                </configuration>
            </plugin>
            <plugin>
                <artifactId>maven-resources-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy-resources</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>copy-resources</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>${project.build.directory}/${basepath}</outputDirectory>
                            <resources>
                                <resource>
                                    <directory>${project.basedir}/src/main/resources/bitrock</directory>
                                    <includes>
                                        <include>${project.artifactId}.xml</include>
                                    </includes>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-dependency-plugin</artifactId>
                <executions>
                    <execution>
                        <id>unpack-dependencies</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>unpack-dependencies</goal>
                        </goals>
                        <configuration>
                            <excludeArtifactIds>quantix-package-common</excludeArtifactIds>
                            <includeTypes>tar.gz,zip</includeTypes>
                            <outputDirectory>${project.build.directory}</outputDirectory>
                            <excludeTransitive>true</excludeTransitive>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <overWriteSnapshots>true</overWriteSnapshots>
                            <artifactItems>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}/${packageFolder}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <classifier>core-${distNameLong}-component</classifier>
                                    <type>${archiveExt}</type>
                                </artifactItem>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}/${packageFolder}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <classifier>core-component${oemClassifier}</classifier>
                                    <type>zip</type>
                                </artifactItem>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}/${packageFolder}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <classifier>core-report-component</classifier>
                                    <type>zip</type>
                                </artifactItem>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}/${packageFolder}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <classifier>email-${distName}-component</classifier>
                                    <type>${archiveExt}</type>
                                </artifactItem>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}/${packageFolder}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <classifier>ftp-${distName}-component</classifier>
                                    <type>${archiveExt}</type>
                                </artifactItem>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <classifier>buildpackage-res</classifier>
                                    <type>zip</type>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
				 <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>exec-maven-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>copy gex pat</id>
                            <phase>prepare-package</phase>
                            <goals>
                                <goal>exec</goal>
                            </goals>
                            <configuration>
                                <workingDirectory>${project.build.directory}/${packageFolder}/bin/</workingDirectory>
                                <executable>cp</executable>
                                <arguments>
                                    <argument>${project.build.directory}/galaxy_products/gex_product/bin/${extendedPathSource}gex</argument>
                                    <argument>${project.build.directory}/${packageFolder}/${extendedPathDest}</argument>
                                </arguments>
                            </configuration>
                        </execution>
                      <execution>
                            <id>copy gsd pat</id>
                            <phase>prepare-package</phase>
                            <goals>
                                <goal>exec</goal>
                            </goals>
                            <configuration>
										  <skip>${skipMac}</skip>
                                <workingDirectory>${project.build.directory}/${packageFolder}/bin/</workingDirectory>
                                <executable>cp</executable>
                                <arguments>
                                    <argument>${project.build.directory}/galaxy_products/gex_product/bin/${extendedPathSourceGsd}gsd</argument>
                                    <argument>${project.build.directory}/${packageFolder}/${extendedPathDestGsd}</argument>
                                </arguments>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>            
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-assembly-plugin</artifactId>
                <executions>
                    <execution>
                        <id>quantix-patman-component</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <appendAssemblyId>false</appendAssemblyId>
                            <attach>false</attach>
                            <descriptors>
                                <descriptor>src/assembly/assembly-quantix-patman-component.xml</descriptor>
                            </descriptors>
                            <formats>
                                <format>dir</format>
                            </formats>
                            <finalName>${packageFolder}</finalName>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
    <profiles>
      <profile>
          <id>win</id>
          <activation>
              <property>
                  <name>win</name>
              </property>
          </activation>
          <build>
            <plugins>
              <plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-assembly-plugin</artifactId>
                  <executions>
                      <execution>
                          <id>quantix-patman-win-component</id>
                          <phase>generate-resources</phase>
                          <goals>
                              <goal>single</goal>
                          </goals>
                          <configuration>
                              <appendAssemblyId>false</appendAssemblyId>
                              <attach>false</attach>
                              <descriptors>
                                  <descriptor>src/assembly/assembly-quantix-patman-win-component.xml</descriptor>
                              </descriptors>
                              <formats>
                                  <format>dir</format>
                              </formats>
                              <finalName>${packageFolder}</finalName>
                          </configuration>
                      </execution>
                  </executions>
              </plugin>
            </plugins>
          </build>
      </profile>
        <profile>
            <id>mac64</id>
            <activation>
                <property>
                    <name>mac64</name>
                </property>
            </activation>
            <properties>
                <skipMac>false</skipMac>
            </properties>
            <!-- <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>quantix-patman-spe-component</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                                <configuration>
                                    <appendAssemblyId>false</appendAssemblyId>
                                    <attach>false</attach>
                                    <descriptors>
                                        <descriptor>src/assembly/assembly-quantix-patman-${distNameLong}-component.xml</descriptor>
                                    </descriptors>
                                    <formats>
                                        <format>dir</format>
                                    </formats>
                                    <finalName>${packageFolder}</finalName>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build> -->
        </profile>
        <profile>
            <id>bitrock</id>
            <activation>
                <property>
                    <name>!noBitrock</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unpack-run</id>
                                <phase>generate-sources</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <overWriteSnapshots>true</overWriteSnapshots>
                                    <skip>${skipCentos6SysLibs}</skip>
                                    <artifactItems>
                                        <artifactItem>
                                            <outputDirectory>${project.build.directory}/${packageFolder}</outputDirectory>
                                            <groupId>com.galaxysemi</groupId>
                                            <artifactId>quantix-package-common</artifactId>
                                            <classifier>core-centos6_64-run-component</classifier>
                                            <type>${archiveExt}</type>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>bitrock</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/${basepath}</workingDirectory>
                                    <environmentVariables>
                                        <DEVDIR>${project.build.directory}</DEVDIR>
                                        <OS>${distName}</OS>
                                        <BUILD>${project.version}</BUILD>
                                        <GALAXY_PACKAGE>${project.build.directory}/${packageFolder}</GALAXY_PACKAGE>
                                        <INSTALLER_FILENAME>${packageName}-${project.version}-${distGroup}${oemClassifier}</INSTALLER_FILENAME>
                                    </environmentVariables>
                                    <executable>${bitrockExec}</executable>
                                    <arguments>
                                        <argument>build</argument>
                                        <argument>${project.artifactId}.xml</argument>
                                        <argument>${bitRockVerbose}</argument>
                                        <argument>--setvars</argument>
                                        <argument>project.outputDirectory=${project.build.directory}</argument>
                                        <argument>--setvars</argument>
                                        <argument>arch=${bitrockArch}</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>zip-mac-app-package</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <skip>${skipMac}</skip>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <executable>zip</executable>
                                    <arguments>
                                        <argument>-r</argument>
                                        <argument>-q</argument>
                                        <argument>${project.build.directory}/${packageName}-${project.version}-${distGroup}.zip</argument>
                                        <argument>${packageName}-${project.version}-${distGroup}.app</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>chmod-bitrock</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <executable>chmod</executable>
                                    <arguments>
                                        <argument>+x</argument>
                                        <argument>${project.build.directory}/${packageName}-${project.version}-${distGroup}${oemClassifier}.${bitrockExtension}</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>build-helper-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>attach-artifacts</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>attach-artifact</goal>
                                </goals>
                                <configuration>
                                    <artifacts>
                                        <artifact>
                                            <file>${project.build.directory}/${packageName}-${project.version}-${distGroup}${oemClassifier}.${bitrockExtension}</file>
                                            <classifier>${oemClassifierPrefix}${distGroup}</classifier>
                                            <type>${bitrockExtension}</type>
                                        </artifact>
                                    </artifacts>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>rpm</id>
            <activation>
                <property>
                    <name>rpm</name>
                </property>
            </activation>
            <properties>
                <skipRpm>false</skipRpm>
            </properties>
        </profile>
        <profile>
            <id>linux</id>
            <activation>
                <property>
                    <name>linux</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-resources-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-rpm-scripts</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${project.build.directory}/rpm/scripts</outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>${project.basedir}/src/main/scripts</directory>
                                            <excludes/>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>rpm-postinstall-replacer</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/rpm/scripts/postinstall</file>
                                    <replacements>
                                        <replacement>
                                            <token>__RPM_PREFIX__</token>
                                            <value>/opt/quantix/${project.artifactId}-${project.version}</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                            <execution>
                                <id>rpm-postremove-replacer</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/rpm/scripts/postremove</file>
                                    <replacements>
                                        <replacement>
                                            <token>__RPM_PREFIX__</token>
                                            <value>/opt/quantix/${project.artifactId}-${project.version}</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>chmod-scripts</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <chmod file="${project.build.directory}/rpm/scripts/preinstall" perm="+x"/>
                                        <chmod file="${project.build.directory}/rpm/scripts/postinstall" perm="+x"/>
                                        <chmod file="${project.build.directory}/rpm/scripts/postremove" perm="+x"/>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>manage-symlinks</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <skip>${skipRpm}</skip>
                                    <workingDirectory>${project.build.directory}/${packageFolder}</workingDirectory>
                                    <executable>${project.basedir}/src/main/script/processSymlinks.sh</executable>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>rpm-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>generate-rpm</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <!-- <autoProvides>false</autoProvides> -->
                            <disabled>${skipRpm}</disabled>
                            <classifier>${distNameLong}</classifier>
                            <group>Management/Instrumentation/Test</group>
                            <license>Galaxy Semiconductor license</license>
                            <distribution>${project.artifactId}</distribution>
                            <!--                            <icon>${project.build.directory}/galaxy_products/gex_product/gex/sources/icons/gex_application_48x48.png</icon> -->
                            <packager>S{project.artifactId}</packager>
                            <prefix>/opt/quantix/${project.artifactId}-${project.version}</prefix>
                            <changelogFile>src/changelog</changelogFile>
                            <defineStatements>
                                <defineStatement>_unpackaged_files_terminate_build 0</defineStatement>
                            </defineStatements>
                            <needarch>x86_64</needarch>
                            <mappings>
                                <mapping>
                                    <directory>/opt/quantix/${project.artifactId}-${project.version}</directory>
                                    <username>quantixUser</username>
                                    <groupname>quantixUser</groupname>
                                    <sources>
                                        <source>
                                            <location>${project.build.directory}/${packageFolder}</location>
                                        </source>
                                    </sources>
                                </mapping>
                                <!-- <mapping>
                                    <directory>/opt/${project.artifactId}-${project.version}/lib</directory>
                                    <sources>
                                        <softlinkSource>
                                            <destination>libmysqlclient.so</destination>
                                            <location>libmariadb.so.2</location>
                                        </softlinkSource>
                                        <softlinkSource>
                                            <destination>libmysqlclient_r.so</destination>
                                            <location>libmariadb.so.2</location>
                                        </softlinkSource>
                                    </sources>
                                </mapping> -->
                            </mappings>
                            <!-- <requires>
                                <require>quantix-package-common</require>
                            </requires> -->
                            <requires>
                                <require>redhat-lsb</require>
                                <require>libgfortran</require>
                                <require>libgomp</require>
                                <require>libicu</require>
                                <require>libxcb</require>
                                <require>mysql-libs</require>
                                <require>readline</require>
                                <require>xcb-util</require>
                                <require>xcb-util-keysyms</require>
                                <require>xcb-util-image</require>
                                <require>xdg-utils</require>
                                <require>xorg-x11-server-Xorg</require>
                            </requires>
                            <preinstallScriptlet>
                                <scriptFile>${project.build.directory}/rpm/scripts/preinstall</scriptFile>
                                <fileEncoding>utf-8</fileEncoding>
                            </preinstallScriptlet>
                            <postinstallScriptlet>
                                <scriptFile>${project.build.directory}/rpm/scripts/postinstall</scriptFile>
                                <fileEncoding>utf-8</fileEncoding>
                            </postinstallScriptlet>
                            <postremoveScriptlet>
                                <scriptFile>${project.build.directory}/rpm/scripts/postremove</scriptFile>
                                <fileEncoding>utf-8</fileEncoding>
                            </postremoveScriptlet>
                            <keyname>${gpg.keyname}</keyname>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
