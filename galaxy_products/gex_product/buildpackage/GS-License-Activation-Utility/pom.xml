<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.galaxysemi</groupId>
        <artifactId>galaxy_dev</artifactId>
        <version>7.7.33-SNAPSHOT</version>
        <relativePath>../../../../pom.xml</relativePath>
    </parent>

    <groupId>com.galaxysemi</groupId>
    <artifactId>quantix-la</artifactId>
    <version>2.0.0</version>
    <packaging>pom</packaging>
    <name>Quantix product - package - GS License Activation Utility</name>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <basepath>galaxy_products/gex_product/buildpackage</basepath>
        <packageName>quantix-la</packageName>
        <packageFolder>${project.artifactId}-package</packageFolder>
        <skipMac>true</skipMac>
        <skipRpm>true</skipRpm>
    </properties>

    <dependencies>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <!-- <version>${global.version}</version> -->
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>quantix-package-common</artifactId>
            <!-- <version>${global.version}</version> -->
            <classifier>buildpackage-res</classifier>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>galaxy-resources</artifactId>
            <!-- <version>${global.version}</version> -->
            <type>zip</type>
            <classifier>res</classifier>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>gex-license-activation</artifactId>
            <!-- <version>${global.version}</version> -->
            <classifier>${distName}-bin</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>gex-src</artifactId>
            <!-- <version>${global.version}</version> -->
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>fnp-toolkit</artifactId>
            <classifier>fnp-utils-${distNameLong}</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>fnp-toolkit</artifactId>
            <classifier>galaxylm-${distNameLong}</classifier>
            <type>${archiveExt}</type>
        </dependency>
        <dependency>
            <groupId>com.flexerasoftware</groupId>
            <artifactId>lmadmin</artifactId>
            <version>${fnp-version}</version>
            <type>${lmadminArchiveExt}</type>
            <classifier>${lmadmin-fnp-platform}</classifier>
        </dependency>
        <!-- <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>galaxy_dev-common</artifactId>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>galaxy_dev-common</artifactId>
            <classifier>src</classifier>
            <type>zip</type>
        </dependency> -->
    </dependencies>

    <build>
        <sourceDirectory>${project.basedir}/src</sourceDirectory>
        <plugins>
            <plugin>
                <artifactId>maven-install-plugin</artifactId>
                <configuration>
                    <createChecksum>true</createChecksum>
                </configuration>
            </plugin>
            <plugin>
                <artifactId>maven-resources-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy-resources</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>copy-resources</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>${project.build.directory}/${basepath}</outputDirectory>
                            <resources>
                                <resource>
                                    <directory>${project.basedir}/src/main/resources/bitrock</directory>
                                    <includes>
                                        <include>${project.artifactId}.xml</include>
                                    </includes>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-dependency-plugin</artifactId>
                <executions>
                    <execution>
                        <id>unpack-dependencies</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>unpack-dependencies</goal>
                        </goals>
                        <configuration>
                            <excludeArtifactIds>quantix-package-common,lmadmin${oemExcludeArtifactIdsSuffix}</excludeArtifactIds>
                            <includeTypes>tar.gz,zip</includeTypes>
                            <outputDirectory>${project.build.directory}</outputDirectory>
                            <excludeTransitive>true</excludeTransitive>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <overWriteSnapshots>true</overWriteSnapshots>
                            <artifactItems>
                                <artifactItem>
                                    <outputDirectory>${project.build.directory}</outputDirectory>
                                    <groupId>com.galaxysemi</groupId>
                                    <artifactId>quantix-package-common</artifactId>
                                    <version>${global.version}</version>
                                    <classifier>buildpackage-res</classifier>
                                    <type>zip</type>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>copy-dependencies</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>copy-dependencies</goal>
                        </goals>
                        <configuration>
                            <includeArtifactIds>lmadmin</includeArtifactIds>
                            <outputDirectory>${project.build.directory}</outputDirectory>
                            <excludeTransitive>true</excludeTransitive>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-assembly-plugin</artifactId>
                <executions>
                    <execution>
                        <id>quantix-la-component</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <appendAssemblyId>false</appendAssemblyId>
                            <attach>false</attach>
                            <descriptors>
                                <descriptor>src/assembly/assembly-quantix-GS-License-Activation-Utility-${distNameLong}-component.xml</descriptor>
                            </descriptors>
                            <formats>
                                <format>dir</format>
                            </formats>
                            <finalName>${packageFolder}</finalName>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
    <profiles>
        <profile>
            <id>mac64</id>
            <activation>
                <property>
                    <name>mac64</name>
                </property>
            </activation>
            <properties>
                <skipMac>false</skipMac>
            </properties>
        </profile>
        <profile>
            <id>bitrock</id>
            <activation>
                <property>
                    <name>!noBitrock</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>bitrock</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/${basepath}</workingDirectory>
                                    <environmentVariables>
                                        <DEVDIR>${project.build.directory}</DEVDIR>
                                        <OS>${distName}</OS>
                                        <BUILD>${project.version}</BUILD>
                                        <GALAXY_PACKAGE>${project.build.directory}/${packageFolder}</GALAXY_PACKAGE>
                                        <INSTALLER_FILENAME>${packageName}-${project.version}-${distGroup}</INSTALLER_FILENAME>
                                    </environmentVariables>
                                    <executable>${bitrockExec}</executable>
                                    <arguments>
                                        <argument>build</argument>
                                        <argument>${project.artifactId}.xml</argument>
                                        <argument>${bitRockVerbose}</argument>
                                        <argument>--setvars</argument>
                                        <argument>project.outputDirectory=${project.build.directory}</argument>
                                        <argument>--setvars</argument>
                                        <argument>arch=${bitrockArch}</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>zip-mac-app-package</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <skip>${skipMac}</skip>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <executable>zip</executable>
                                    <arguments>
                                        <argument>-r</argument>
                                        <argument>-q</argument>
                                        <argument>${project.build.directory}/${packageName}-${project.version}-${distGroup}.zip</argument>
                                        <argument>${packageName}-${project.version}-${distGroup}.app</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>chmod-bitrock</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <executable>chmod</executable>
                                    <arguments>
                                        <argument>+x</argument>
                                        <argument>${project.build.directory}/${packageName}-${project.version}-${distGroup}.${bitrockExtension}</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>build-helper-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>attach-artifacts</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>attach-artifact</goal>
                                </goals>
                                <configuration>
                                    <artifacts>
                                        <artifact>
                                            <file>${project.build.directory}/${packageName}-${project.version}-${distGroup}.${bitrockExtension}</file>
                                            <classifier>${distGroup}</classifier>
                                            <type>${bitrockExtension}</type>
                                        </artifact>
                                    </artifacts>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>rpm</id>
            <activation>
                <property>
                    <name>rpm</name>
                </property>
            </activation>
            <properties>
                <skipRpm>false</skipRpm>
            </properties>
        </profile>
        <profile>
            <id>linux</id>
            <activation>
                <property>
                    <name>linux</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-resources-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-rpm-scripts</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${project.build.directory}/rpm/scripts</outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>${project.basedir}/src/main/scripts</directory>
                                            <excludes/>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>rpm-postinstall-replacer</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/rpm/scripts/postinstall</file>
                                    <replacements>
                                        <replacement>
                                            <token>__RPM_PREFIX__</token>
                                            <value>/opt/${project.artifactId}-${project.version}</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                            <execution>
                                <id>rpm-postremove-replacer</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/rpm/scripts/postremove</file>
                                    <replacements>
                                        <replacement>
                                            <token>__RPM_PREFIX__</token>
                                            <value>/opt/${project.artifactId}-${project.version}</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>chmod-scripts</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <chmod file="${project.build.directory}/rpm/scripts/preinstall" perm="+x"/>
                                        <chmod file="${project.build.directory}/rpm/scripts/postinstall" perm="+x"/>
                                        <chmod file="${project.build.directory}/rpm/scripts/postremove" perm="+x"/>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>manage-symlinks</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <skip>${skipRpm}</skip>
                                    <workingDirectory>${project.build.directory}/${packageFolder}</workingDirectory>
                                    <executable>${project.basedir}/src/main/script/processSymlinks.sh</executable>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>rpm-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>generate-rpm</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <!-- <projversion>${fnpProxyVersion}</projversion> -->
                            <disabled>${skipRpm}</disabled>
                            <classifier>${distNameLong}</classifier>
                            <group>Management/Instrumentation/Test</group>
                            <license>Galaxy Semiconductor license</license>
                            <distribution>${project.artifactId}</distribution>
                            <!--                            <icon>${project.build.directory}/galaxy_products/gex_product/gex/sources/icons/gex_application_48x48.png</icon> -->
                            <packager>S{project.artifactId}</packager>
                            <prefix>/opt/${project.artifactId}-${project.version}</prefix>
                            <changelogFile>src/changelog</changelogFile>
                            <defineStatements>
                                <defineStatement>_unpackaged_files_terminate_build 0</defineStatement>
                                <defineStatement>__os_install_post %{nil}</defineStatement>
                            </defineStatements>
                            <needarch>x86_64</needarch>
                            <mappings>
                                <mapping>
                                    <directory>/opt/${project.artifactId}-${project.version}</directory>
                                    <username>quantixUser</username>
                                    <groupname>quantixUser</groupname>
                                    <sources>
                                        <source>
                                            <location>${project.build.directory}/${packageFolder}</location>
                                        </source>
                                    </sources>
                                </mapping>
                            </mappings>
                            <requires>
                                <!-- <require>redhat-lsb.i686</require> -->
                                <require>libgfortran</require>
                                <require>libgomp</require>
                                <require>libicu</require>
                                <require>libxcb</require>
                                <require>mysql-libs</require>
                                <require>readline</require>
                                <require>xcb-util</require>
                                <require>xcb-util-keysyms</require>
                                <require>xcb-util-image</require>
                                <require>xdg-utils</require>
                                <require>xorg-x11-server-Xorg</require>
                            </requires>
                            <preinstallScriptlet>
                                <scriptFile>${project.build.directory}/rpm/scripts/preinstall</scriptFile>
                                <fileEncoding>utf-8</fileEncoding>
                            </preinstallScriptlet>
                            <postinstallScriptlet>
                                <scriptFile>${project.build.directory}/rpm/scripts/postinstall</scriptFile>
                                <fileEncoding>utf-8</fileEncoding>
                            </postinstallScriptlet>
                            <postremoveScriptlet>
                                <scriptFile>${project.build.directory}/rpm/scripts/postremove</scriptFile>
                                <fileEncoding>utf-8</fileEncoding>
                            </postremoveScriptlet>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>oemTeradyne</id>
            <activation>
                <property>
                    <name>oemTeradyne</name>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>com.galaxysemi</groupId>
                    <artifactId>ter-lp</artifactId>
                    <version>${project.version}</version>
                    <classifier>${distName}-lib</classifier>
                    <type>${archiveExt}</type>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>oemTeradynePro</id>
            <activation>
                <property>
                    <name>oemTeradynePro</name>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>com.galaxysemi</groupId>
                    <artifactId>ter-lp</artifactId>
                    <version>${project.version}</version>
                    <classifier>${distName}-lib</classifier>
                    <type>${archiveExt}</type>
                </dependency>
            </dependencies>
        </profile>
    </profiles>
</project>
