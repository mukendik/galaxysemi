<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.galaxysemi</groupId>
        <artifactId>R</artifactId>
        <relativePath>../pom.xml</relativePath>
        <version>3.0.1-8-SNAPSHOT</version>
    </parent>

    <artifactId>libR</artifactId>
    <packaging>pom</packaging>
    <name>libR</name>

    <dependencies>
        <dependency>
            <groupId>com.galaxysemi</groupId>
            <artifactId>R-dependencies</artifactId>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>org.r-project.cran</groupId>
            <artifactId>R</artifactId>
            <classifier>src</classifier>
            <type>tar.gz</type>
        </dependency>
        <dependency>
            <groupId>org.r-project.cran</groupId>
            <artifactId>diptest</artifactId>
            <classifier>src</classifier>
            <type>tar.gz</type>
        </dependency>
    </dependencies>

    <build>
        <sourceDirectory>${project.basedir}/src</sourceDirectory>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>sonar-maven-plugin</artifactId>
                <!--                <configuration>
                    <sonarHostURL>http://gfactory/sonarqube</sonarHostURL>
                </configuration>-->
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-dependency-plugin</artifactId>
                <executions>
                    <execution>
                        <id>unpack-R-src</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>unpack-dependencies</goal>
                        </goals>
                        <configuration>
                            <includeArtifactIds>R</includeArtifactIds>
                            <outputDirectory>${project.build.directory}</outputDirectory>
                            <excludeTransitive>true</excludeTransitive>
                            <excludes>**\/*.tgz</excludes>
                        </configuration>
                    </execution>
                    <execution>
                        <id>prepare-diptest</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>org.r-project.cran</groupId>
                                    <artifactId>diptest</artifactId>
                                    <version>${diptestVersion}</version>
                                    <classifier>src</classifier>
                                    <type>tar.gz</type>
                                    <outputDirectory>${project.build.directory}/R-${RVersion}/src/library/Recommended</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                            <includeArtifactIds>diptest</includeArtifactIds>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-patch-plugin</artifactId>
                <configuration>
                    <skipApplication>false</skipApplication>
                </configuration>
                <executions>
                    <execution>
                        <id>patches</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>apply</goal>
                        </goals>
                        <configuration>
                            <patchDirectory>${project.basedir}/src/patch</patchDirectory>
                            <targetDirectory>${project.build.directory}</targetDirectory>
                            <patches>
                                <patch>R_CStackLimit.patch</patch>
                                <patch>R_CStackLimit_win.patch</patch>
                            </patches>
                            <strip>0</strip>
                            <ignoreWhitespace>false</ignoreWhitespace>
                            <!--<reverse>true</reverse>-->
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!--

            -->
            <!--            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-antrun-plugin</artifactId>
                <executions>
                    <execution>
                        <id>remove-some-recommended-r-packages</id>
                        <phase>process-sources</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <tasks>
                                <delete>
                                    <fileset dir="${project.build.directory}/R-${RVersion}/src/library/Recommended" includes="*.xml" />
                                </delete>
                            </tasks>
                        </configuration>
                    </execution>
                </executions>
            </plugin>-->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-assembly-plugin</artifactId>
                <executions>
                    <execution>
                        <id>assembly-r-home</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <appendAssemblyId>false</appendAssemblyId>
                            <attach>false</attach>
                            <descriptors>
                                <descriptor>src/assembly/assembly-home.xml</descriptor>
                            </descriptors>
                            <finalName>${project.artifactId}-${project.version}-${distNameLong}-home</finalName>
                        </configuration>
                    </execution>
                    <execution>
                        <id>assembly-lib</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <appendAssemblyId>false</appendAssemblyId>
                            <attach>false</attach>
                            <descriptors>
                                <descriptor>src/assembly/assembly-lib.xml</descriptor>
                            </descriptors>
                            <finalName>${project.artifactId}-${project.version}-${distNameLong}-lib</finalName>
                        </configuration>
                    </execution>
                    <execution>
                        <id>assembly-inc</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <appendAssemblyId>false</appendAssemblyId>
                            <attach>false</attach>
                            <descriptors>
                                <descriptor>src/assembly/assembly-inc.xml</descriptor>
                            </descriptors>
                            <finalName>${project.artifactId}-${project.version}-inc</finalName>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>com.google.code.maven-replacer-plugin</groupId>
                <artifactId>replacer</artifactId>
                <executions>
                    <execution>
                        <id>patch-vars.mk</id>
                        <phase>process-sources</phase>
                        <goals>
                            <goal>replace</goal>
                        </goals>
                        <configuration>
                            <file>${project.build.directory}/R-${RVersion}/share/make/vars.mk</file>
                            <!--<outputFile>${project.build.directory}/build/src/gnuwin32/MkRules.local</outputFile>-->
                            <regex>true</regex>
                            <replacements>
                                <replacement>
                                    <token>R_PKGS_RECOMMENDED =.*</token>
                                    <!--<value>R_PKGS_RECOMMENDED =  MASS lattice Matrix nlme survival boot cluster codetools foreign KernSmooth rpart class nnet spatial mgcv diptest</value>-->
                                    <value>R_PKGS_RECOMMENDED = diptest</value>
                                </replacement>
                            </replacements>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>attach-artifacts</id>
                        <phase>package</phase>
                        <goals>
                            <goal>attach-artifact</goal>
                        </goals>
                        <configuration>
                            <artifacts>
                                <artifact>
                                    <file>${project.build.directory}/${project.artifactId}-${project.version}-${distNameLong}-home.${archiveExt}</file>
                                    <classifier>${distNameLong}-home</classifier>
                                    <type>${archiveExt}</type>
                                </artifact>
                                <artifact>
                                    <file>${project.build.directory}/${project.artifactId}-${project.version}-${distNameLong}-lib.${archiveExt}</file>
                                    <classifier>${distNameLong}-lib</classifier>
                                    <type>${archiveExt}</type>
                                </artifact>
                                <artifact>
                                    <file>${project.build.directory}/${project.artifactId}-${project.version}-inc.zip</file>
                                    <classifier>inc</classifier>
                                    <type>zip</type>
                                </artifact>
                            </artifacts>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <id>unix</id>
            <activation>
                <property>
                    <name>!win</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>rename-diptest</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                                <configuration>
                                    <appendAssemblyId>false</appendAssemblyId>
                                    <attach>false</attach>
                                    <descriptors>
                                        <descriptor>src/assembly/assembly-diptest-unix.xml</descriptor>
                                    </descriptors>
                                    <finalName>R-${RVersion}</finalName>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>mac64</id>
            <activation>
                <property>
                    <name>mac64</name>
                </property>
            </activation>
            <properties>
                <makeDist>mac</makeDist>
                <distName>mac</distName>
                <!--<distNameLong>${env.distNameLong}</distNameLong>-->
                <libSuffix>lib</libSuffix>
                <archiveExt>tar.gz</archiveExt>
                <F77>gfortran-4.2 -arch x86_64</F77>
                <!--<makefile>Makefile_mac</makefile>-->
                <!-- cf http://cran.r-project.org/doc/manuals/r-release/R-admin.html#OS-X -->
                <R_HOME>${project.build.directory}/install/R.framework/Versions/3.0/Resources</R_HOME>
                <R_HOME_LIB>${project.build.directory}/install/R.framework/Versions/3.0/Resources/lib</R_HOME_LIB>
                <R_HOME_INCLUDE>${project.build.directory}/install/R.framework/Versions/3.0/Resources/include</R_HOME_INCLUDE>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>link-diptest</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/R-${RVersion}/src/library/Recommended</workingDirectory>
                                    <executable>ln</executable>
                                    <commandlineArgs>-sf diptest_${diptestVersion}.tar.gz diptest.tgz</commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>configure</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <environmentVariables>
                                        <CC>llvm-gcc-4.2</CC>
                                        <CXX>llvm-g++-4.2</CXX>
                                        <F77>${F77}</F77>
                                        <FC>${F77}</FC>
                                        <OBJC>clang</OBJC>
                                    </environmentVariables>
                                    <workingDirectory>${project.build.directory}/build</workingDirectory>
                                    <executable>${project.build.directory}/R-${RVersion}/configure</executable>
                                    <commandlineArgs></commandlineArgs>
                                    <arguments>
                                        <argument>--prefix=${project.build.directory}/install</argument>
                                        <argument>--libdir=${project.build.directory}/install/lib</argument>
                                        <argument>--includedir=${project.build.directory}/install/include</argument>
                                        <argument>--enable-R-shlib</argument>
                                        <argument>--with-cairo</argument>
                                        <argument>--with-libpng</argument>
                                        <argument>--with-x</argument>
                                        <argument>--with-jpeglib</argument>
                                        <!--<argument>-without-system-xz</argument>-->
                                        <!--<argument>-enable-static</argument>-->
                                        <!--<argument>-disable-nls</argument>-->
                                        <!--                                        <argument>CC=/usr/bin/llvm-gcc-4.2</argument>
                                        <argument>CXX=/usr/bin/llvm-g++-4.2</argument>
                                        <argument>F77="/usr/local/bin/gfortran-4.2 -arch x86_64"</argument>-->
                                        <!--                                        <argument>FC=$F77</argument>
                                        <argument>OBJC="clang"</argument>-->
                                        <!--<argument>-without-recommended-packages</argument>-->
                                    </arguments>
                                    <!--LIBnn=lib-->
                                </configuration>
                            </execution>
                            <execution>
                                <id>make</id>
                                <phase>compile</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <!-- http://cran.r-project.org/doc/manuals/r-release/R-admin.html#Building-the-core-files -->
                                    <environmentVariables>
                                        <R_NO_BASE_COMPILE>x</R_NO_BASE_COMPILE>
                                    </environmentVariables>
                                    <workingDirectory>${project.build.directory}/build</workingDirectory>
                                    <executable>make</executable>
                                    <!--<commandlineArgs>${makeOptions} all recommended</commandlineArgs>-->
                                    <commandlineArgs>${makeOptions}</commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>make-install</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/build</workingDirectory>
                                    <executable>make</executable>
                                    <commandlineArgs>install</commandlineArgs>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>linux</id>
            <activation>
                <property>
                    <name>linux</name>
                </property>
            </activation>
            <properties>
                <binDir>bin</binDir>
                <libDir>lib</libDir>
                <osName>linux</osName>
                <makeDist>linux</makeDist>
                <libSuffix>lib</libSuffix>
                <libPostfix>.so*</libPostfix>
                <archiveExt>tar.gz</archiveExt>
                <R_HOME>${project.build.directory}/install/lib/R</R_HOME>
                <R_HOME_LIB>${project.build.directory}/install/lib/R/lib</R_HOME_LIB>
                <R_HOME_INCLUDE>${project.build.directory}/install/lib/R/include</R_HOME_INCLUDE>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>link-diptest</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/R-${RVersion}/src/library/Recommended</workingDirectory>
                                    <executable>ln</executable>
                                    <commandlineArgs>-sf diptest_${diptestVersion}.tar.gz diptest.tgz</commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>configure</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/build</workingDirectory>
                                    <executable>${project.build.directory}/R-${RVersion}/configure</executable>
                                    <arguments>
                                        <argument>--prefix=${project.build.directory}/install</argument>
                                        <argument>--libdir=${project.build.directory}/install/lib</argument>
                                        <argument>--includedir=${project.build.directory}/install/include</argument>
                                        <argument>--enable-R-shlib</argument>
                                        <argument>--with-cairo</argument>
                                        <argument>--with-libpng</argument>
                                        <argument>--with-x</argument>
                                        <argument>--with-jpeglib</argument>
                                        <!--<argument>-without-recommended-packages</argument>-->
                                    </arguments>
                                    <!--LIBnn=lib-->
                                </configuration>
                            </execution>
                            <!-- http://cran.r-project.org/doc/manuals/r-release/R-admin.html#Installing-R-under-Unix_002dalikes -->
                            <execution>
                                <id>make</id>
                                <phase>compile</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/build</workingDirectory>
                                    <executable>make</executable>
                                    <commandlineArgs>${makeOptions}</commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>make-install</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/build</workingDirectory>
                                    <executable>make</executable>
                                    <commandlineArgs>install</commandlineArgs>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <!--        <profile>
            <id>linux32</id>
            <activation>
                <activeByDefault>true</activeByDefault>
                <property>
                    <name>linux32</name>
                </property>
            </activation>
            <properties>
                <distName>linux32</distName>
            </properties>
        </profile>
        <profile>
            <id>linux64</id>
            <activation>
                <property>
                    <name>linux64</name>
                </property>
            </activation>
            <properties>
                <distName>linux64</distName>
            </properties>
        </profile>         -->
        <profile>
            <id>win</id>
            <activation>
                <property>
                    <name>win</name>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>org.r-project.cran</groupId>
                    <artifactId>Rtools</artifactId>
                    <version>${RtoolsVersion}</version>
                    <type>exe</type>
                </dependency>
                <dependency>
                    <groupId>com.galaxysemi</groupId>
                    <artifactId>R-extra</artifactId>
                    <version>${project.version}</version>
                    <type>pom</type>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>create-diptest-folder</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <tasks>
                                        <mkdir dir="${project.build.directory}/build/src/library/Recommended"/>
                                    </tasks>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-Rtools</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>Rtools</includeArtifactIds>
                                    <includeTypes>exe</includeTypes>
                                    <outputDirectory>${project.build.directory}</outputDirectory>
                                    <excludeTransitive>true</excludeTransitive>
                                </configuration>
                            </execution>
                            <execution>
                                <id>unpack-Rtools-extra</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>Rtools</includeArtifactIds>
                                    <includeTypes>zip</includeTypes>
                                    <outputDirectory>${project.build.directory}</outputDirectory>
                                    <excludeTransitive>true</excludeTransitive>
                                </configuration>
                            </execution>
                            <execution>
                                <id>prepare-diptest</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>copy</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>org.r-project.cran</groupId>
                                            <artifactId>diptest</artifactId>
                                            <version>${diptestVersion}</version>
                                            <classifier>src</classifier>
                                            <type>tar.gz</type>
                                            <outputDirectory>${project.build.directory}/build/src/library/Recommended</outputDirectory>
                                        </artifactItem>
                                    </artifactItems>
                                    <includeArtifactIds>diptest</includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>build-helper-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>parse-version</id>
                                <goals>
                                    <goal>parse-version</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>toolPath-property</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>regex-property</goal>
                                </goals>
                                <configuration>
                                    <name>toolPath</name>
                                    <value>${project.build.directory}/Rtools/gcc-4.6.3/bin/</value>
                                    <regex>\\</regex>
                                    <replacement>/</replacement>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>include-extra-sources</id>
                                <phase>generate-sources</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                                <configuration>
                                    <appendAssemblyId>false</appendAssemblyId>
                                    <attach>false</attach>
                                    <descriptors>
                                        <descriptor>src/assembly/assembly-src-${distName}.xml</descriptor>
                                    </descriptors>
                                    <formats>
                                        <format>dir</format>
                                    </formats>
                                    <finalName>build</finalName>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>rename-diptest</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                                <configuration>
                                    <appendAssemblyId>false</appendAssemblyId>
                                    <attach>false</attach>
                                    <descriptors>
                                        <descriptor>src/assembly/assembly-diptest-win.xml</descriptor>
                                    </descriptors>
                                    <finalName>build</finalName>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <!--                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>wagon-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>download-Rtools</id>
                                <phase>generate-sources</phase>
                                <goals>
                                    <goal>download-single</goal>
                                </goals>
                                <configuration>
                                    <url>http://cran.r-project.org</url>
                                    <fromFile>bin/windows/Rtools/Rtools${parsedVersion.majorVersion}${parsedVersion.minorVersion}.exe</fromFile>
                                    <toDir>${project.build.directory}/Rtools</toDir>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>-->
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>patch-vars.mk</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/build/share/make/vars.mk</file>
                                    <regex>true</regex>
                                    <replacements>
                                        <replacement>
                                            <token>R_PKGS_RECOMMENDED =.*</token>
                                            <value>R_PKGS_RECOMMENDED = diptest</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>install-Rtools</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/Rtools</workingDirectory>
                                    <!-- Inno Setup doc: http://www.jrsoftware.org/ishelp/index.php?topic=setupcmdline -->
                                    <executable>${project.build.directory}/Rtools-${RtoolsVersion}.exe</executable>
                                    <arguments>
                                        <argument>/VERYSILENT</argument>
                                        <argument>/Dir="${project.build.directory}${fs}Rtools"</argument>
                                        <argument>/Lang=english</argument>
                                        <argument>/Group=Rtools</argument>
                                        <argument>/NoIcons=0</argument>
                                        <argument>/SetupType=custom</argument>
                                        <argument>/Components=rtools,cygwin,gcc463</argument>
                                        <argument>/Tasks=setpath,recordversion</argument>
                                        <argument>/Log=${project.build.directory}${fs}Rtools.log</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cp-diptest</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>${project.build.directory}/build/src/library/Recommended</workingDirectory>
                                    <executable>cp</executable>
                                    <commandlineArgs>-p diptest_${diptestVersion}.tar.gz diptest.tgz</commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>make</id>
                                <phase>compile</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <environmentVariables>
                                        <!-- Priority to cygwin path-->
                                        <PATH>${env.CYG_PATH};${env.PATH}</PATH>
                                        <!-- for case sensitive with sort command -->
                                        <LC_COLLATE>C</LC_COLLATE>
                                    </environmentVariables>
                                    <workingDirectory>${project.build.directory}/build/src/gnuwin32</workingDirectory>
                                    <executable>make</executable>
                                    <commandlineArgs>${makeOptions} MkRules rbuild rpackages bitmapdll recommended</commandlineArgs>
                                </configuration>
                            </execution>
                            <!-- <execution>
                                <id>make-po</id>
                                <phase>compile</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <environmentVariables>
                                        <PATH>${env.CYG_PATH};${env.PATH}</PATH>
                                    </environmentVariables>
                                    <workingDirectory>${project.build.directory}/build/src/gnuwin32</workingDirectory>
                                    <executable>make</executable>
                                    <commandlineArgs>${makeOptions} -C ../../po -f Makefile.win</commandlineArgs>
                                </configuration>
                            </execution> -->
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>win32</id>
            <activation>
                <property>
                    <name>win32</name>
                </property>
            </activation>
            <properties>
                <R_HOME>${project.build.directory}/build</R_HOME>
                <R_HOME_LIB>${R_HOME}/bin/i386</R_HOME_LIB>
                <R_HOME_INCLUDE>${R_HOME}/include</R_HOME_INCLUDE>
            </properties>
            <dependencies>
                <dependency>
                    <groupId>org.r-project.cran</groupId>
                    <artifactId>Rtools</artifactId>
                    <version>${RtoolsVersion}</version>
                    <classifier>extra</classifier>
                    <type>zip</type>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unpack-Rtools-extra</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>org.r-project.cran</groupId>
                                            <artifactId>Rtools</artifactId>
                                            <version>${RtoolsVersion}</version>
                                            <classifier>extra</classifier>
                                            <type>zip</type>
                                            <outputDirectory>${project.build.directory}/R-${RVersion}</outputDirectory>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>patch-MkRules</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/build/src/gnuwin32/MkRules.dist</file>
                                    <outputFile>${project.build.directory}/build/src/gnuwin32/MkRules.local</outputFile>
                                    <regex>true</regex>
                                    <replacements>
                                        <replacement>
                                            <token>MULTI =.*</token>
                                            <value>MULTI =</value>
                                        </replacement>
                                        <replacement>
                                            <token>TOOL_PATH =.*</token>
                                            <value>TOOL_PATH = ${toolPath}</value>
                                        </replacement>
                                        <replacement>
                                            <token>BINPREF =.*</token>
                                            <value>BINPREF = ${toolPath}</value>
                                        </replacement>
                                        <replacement>
                                            <token>M_ARCH =.*</token>
                                            <value>M_ARCH = -m32</value>
                                        </replacement>
                                        <replacement>
                                            <token>AS_ARCH =.*</token>
                                            <value>AS_ARCH = --32</value>
                                        </replacement>
                                        <replacement>
                                            <token>RC_ARCH =.*</token>
                                            <value>RC_ARCH = -F pe-i386</value>
                                        </replacement>
                                        <replacement>
                                            <token>DT_ARCH =.*</token>
                                            <value>DT_ARCH = -m i386 --as-flags --32</value>
                                        </replacement>
                                        <replacement>
                                            <token>WIN =.*</token>
                                            <value>WIN = 32</value>
                                        </replacement>
                                        <replacement>
                                            <token>ICU_PATH =.*</token>
                                            <value>ICU_PATH = ${env.ICU_PATH}/lib</value>
                                        </replacement>
                                        <replacement>
                                            <token>MIKTEX =.*</token>
                                            <value>MIKTEX =</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>win64</id>
            <activation>
                <property>
                    <name>win64</name>
                </property>
            </activation>
            <properties>
                <R_HOME>${project.build.directory}/build</R_HOME>
                <R_HOME_LIB>${R_HOME}/bin/x64</R_HOME_LIB>
                <R_HOME_INCLUDE>${R_HOME}/include</R_HOME_INCLUDE>
            </properties>
            <dependencies>
                <dependency>
                    <groupId>org.r-project.cran</groupId>
                    <artifactId>Rtools</artifactId>
                    <version>${RtoolsVersion}</version>
                    <classifier>extra64</classifier>
                    <type>zip</type>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unpack-Rtools-extra</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>org.r-project.cran</groupId>
                                            <artifactId>Rtools</artifactId>
                                            <version>${RtoolsVersion}</version>
                                            <classifier>extra64</classifier>
                                            <type>zip</type>
                                            <outputDirectory>${project.build.directory}/R-${RVersion}</outputDirectory>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <executions>
                            <execution>
                                <id>patch-MkRules</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>${project.build.directory}/build/src/gnuwin32/MkRules.dist</file>
                                    <outputFile>${project.build.directory}/build/src/gnuwin32/MkRules.local</outputFile>
                                    <regex>true</regex>
                                    <replacements>
                                        <replacement>
                                            <token>MULTI =.*</token>
                                            <value>MULTI = 64</value>
                                        </replacement>
                                        <replacement>
                                            <token>TOOL_PATH =.*</token>
                                            <value>TOOL_PATH = ${toolPath}</value>
                                        </replacement>
                                        <replacement>
                                            <token>BINPREF64 =.*</token>
                                            <value>BINPREF64 =</value>
                                        </replacement>
                                        <replacement>
                                            <token>M_ARCH =.*</token>
                                            <value>M_ARCH = -m64</value>
                                        </replacement>
                                        <replacement>
                                            <token>AS_ARCH =.*</token>
                                            <value>AS_ARCH = --64</value>
                                        </replacement>
                                        <replacement>
                                            <token>RC_ARCH =.*</token>
                                            <value>RC_ARCH = -f pe-x86-64</value>
                                        </replacement>
                                        <replacement>
                                            <token>DT_ARCH =.*</token>
                                            <value>DT_ARCH = -m i386:x86-64 --as-flags --64</value>
                                        </replacement>
                                        <replacement>
                                            <token>WIN =.*</token>
                                            <value>WIN = 64</value>
                                        </replacement>
                                        <replacement>
                                            <token>ICU_PATH =.*</token>
                                            <value>ICU_PATH = ${env.ICU_PATH}/lib</value>
                                        </replacement>
                                        <replacement>
                                            <token>MIKTEX =.*</token>
                                            <value>MIKTEX =</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
